<!DOCTYPE html><html lang="<%= page_lang %>"><head><meta http-equiv=content-type content="text/html; charset=utf-8"><meta name=viewport content="width=device-width,initial-scale=1"><title> <%= setup_page_title %> </title><meta name=apple-mobile-web-app-title content="BrewPi Setup"><meta name=apple-mobile-web-app-capable content=yes><script>function invoke(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&(200==n.status?e.success(n.responseText):n.onerror(n.status))},n.ontimeout=function(){void 0!==e.timeout?e.timeout():n.onerror(-1)},n.onerror=function(n){void 0!==e.fail&&e.fail(n)},n.open(e.m,e.url,!0),void 0!==e.data?(n.setRequestHeader("Content-Type",void 0!==e.mime?e.mime:"application/x-www-form-urlencoded"),n.send(e.data)):n.send()}var BWF={BrewProfile:"/brewing.json",process:function(msg){if(null==this.raw)for(var key in eval("m={"+msg+"}"),m)void 0!==this.handlers[key]&&this.handlers[key](m[key]);else this.raw(msg)},on:function(n,e){this.handlers[n]=e},send:function(n){1==this.ws.readyState&&this.ws.send(n)},reconnecting:!1,connect:function(){var e=this;if("undefined"!=typeof WebSocket){var n=new WebSocket("ws://"+document.location.host+"/ws");(e.ws=n).onopen=function(){console.log("Connected"),e.onconnect()},n.onclose=function(){e.reconnecting||(console.log("WS close"),e.error(-2),e.auto&&setTimeout(function(){e.reconnect()},5e3))},n.onmessage=function(n){e.process(n.data)}}else alert("Error! WebSocket Not Supported!")},reconnect:function(n){n=void 0!==n;var e=this;e.reconnecting||(n||1!=e.ws.readyState)&&(console.log("reconnect forced:"+n+" state:"+e.ws.readyState),e.reconnecting=!0,e.ws.close(),e.connect(),e.reconnecting=!1)},init:function(n){var e=this;e.error=void 0===n.error?function(){}:n.error,e.handlers=void 0===n.handlers?{}:n.handlers,e.raw=void 0===n.raw?null:n.raw,e.onconnect=void 0===n.onconnect?function(){}:n.onconnect,e.auto=void 0===n.reconnect||n.reconnect,e.connect()},save:function(n,e,o,t){invoke({m:"POST",url:"/fputs",data:"path="+n+"&content="+encodeURIComponent(e),success:function(){o()},fail:function(n){t(n)}})},load:function(n,e,o){invoke({m:"GET",url:n,success:function(n){e(n)},fail:function(n){o(n)}})}}</script><script>var BackupFile="/device.cfg",devices={add:function(e,n){var t;2==n.h?((t=window.sensorContainer.cloneNode(!0)).querySelector("span.device-address").innerHTML=n.a,t.querySelector("span.device-value").innerHTML=void 0===n.v?"-":n.v):5==n.h?(t=window.extsensorContainer.cloneNode(!0)).querySelector("span.device-value").innerHTML=void 0===n.v?"-":n.v:(3==n.h?((t=window.owContainer.cloneNode(!0)).querySelector("span.device-address").innerHTML=n.a,t.querySelector("span.device-channel").innerHTML=n.n,t.querySelector("select.device-pintype").value=n.x):(t=window.pinContainer.cloneNode(!0)).querySelector("select.device-pintype").value=n.x,t.querySelector("span.device-value").innerHTML=void 0===n.v?"-":n.v?"active":"inactive"),t.querySelector("select.slot-select").value=n.i;t.querySelector("span.device-pin").innerHTML=0<n.p?{0:"D3",1:"D10",2:"D4",3:"D9",4:"D2",5:"D1",12:"D6",13:"D7",14:"D5",15:"D8",16:"D0",17:"A0"}[n.p]:"NA",t.querySelector("select.device-function").value=n.f,t.querySelector("div.device-title").innerHTML="Device "+e,t.querySelector("button").onclick=function(){device_apply(e)},t.hardwaretype=n.h,t.pinnumber=n.p;var i=n.i<0?"detected-list":"installed-list",l=document.getElementById(i);l.appendChild(t),l.appendChild(document.createElement("br"))}},installed_list=[],available_list=[];function cmdfrom(e){var n;n=e<installed_list.length?installed_list[e]:available_list[e-installed_list.length];var t=document.querySelectorAll("div.device-container")[e],i={};return i.i=t.querySelector("select.slot-select").value,i.c=1,i.f=t.querySelector("select.device-function").value,9<=i.f&&i.f<=15?i.b=1:i.b=0,i.h=n.h,i.p=n.p,2==i.h?i.a=n.a:3==i.h?(i.a=n.a,i.n=n.n,i.x=t.querySelector("select.device-pintype").value):1==i.h&&(i.x=t.querySelector("select.device-pintype").value),i}function device_apply(e){blockscreen("<%= script_setup_updating %>");var n=cmdfrom(e),t="U"+JSON.stringify(n);console.log(t);var i=setTimeout(function(){alert("<%= setup_update_timeout %>"),unblockscreen()},5e3);BWF.on("U",function(e){i&&clearTimeout(i),unblockscreen()}),BWF.send(t)}function backup(){if(0!=installed_list.length){for(var e=[],n=0;n<installed_list.length;n++){var t=installed_list[n],i={i:t.i,c:t.c,b:t.b,f:t.f,h:t.h,p:t.p};2==t.h?i.a=t.a:i.x=t.x,e.push(i)}var l=JSON.stringify(e);console.log(l),BWF.save(BackupFile,l,function(){alert("<%= done %>")},function(e){alert("<%= script_setup_error_saving %>"+e)})}else alert("<%= script_setup_no_installed_devices %>")}function restore(){blockscreen("<%= script_setup_restoring %>"),BWF.load(BackupFile,function(e){var n=JSON.parse(e),t=0;BWF.on("U",function(e){if(++t>=n.length)return BWF.on("U",null),void unblockscreen();BWF.send("U"+JSON.stringify(n[t]))}),BWF.send("U"+JSON.stringify(n[t]))},function(e){alert("<%= script_setup_error_load %>"+e),unblockscreen()})}function list(){blockscreen("<%= script_setup_retrieving %>"),installed_list=[],available_list=[],document.getElementById("detected-list").innerHTML="",document.getElementById("installed-list").innerHTML="",BWF.send("d{r:1}"),BWF.send("h{u:-1,v:1}")}function erase(){confirm("<%= script_setup_erase_all_setting %>")&&BWF.send("E")}function listGot(){document.getElementById("detected-list").innerHTML="",document.getElementById("installed-list").innerHTML="";for(var e=0,n=0;n<installed_list.length;n++)devices.add(e++,installed_list[n]);for(n=0;n<available_list.length;n++)devices.add(e++,available_list[n]);unblockscreen()}function detachNode(e){var n=document.querySelector(e);return n.parentNode.removeChild(n),n}function init(e){void 0===e&&(e=!1),e||(getActiveNavItem(),Q("#verinfo").innerHTML="v"+JSVERSION),window.sensorContainer=detachNode(".device-container.sensor-device"),window.pinContainer=detachNode(".device-container.pin-device"),window.extsensorContainer=detachNode(".device-container.extsensor-device"),window.owContainer=detachNode(".device-container.ow-device"),BWF.init({error:function(e){},handlers:{d:function(e){installed_list=e},h:function(e){available_list=e,listGot()}}})}function blockscreen(e){document.getElementById("blockscreencontent").innerHTML=e,document.getElementById("blockscreen").style.display="block"}function unblockscreen(){document.getElementById("blockscreen").style.display="none"}</script></head><style>button{color:#1d5987;background:#dfeffc;font-weight:700;border-top-right-radius:5px;border-top-left-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.corner-top{border-top-right-radius:5px;border-top-left-radius:5px}.corner-bottom{border-bottom-right-radius:5px;border-bottom-left-radius:5px}.navbar{margin:0;padding:.2em .2em 0;border:1px solid #4297d7;background:#5c9ccc;color:#fff;height:2em;display:block;position:relative}.bar-title{margin-right:160px;font-weight:700}.device-container{border:1px solid;padding:5px}.device-setting-container{padding:5px;width:150px;float:left;color:#555}.device-titleNapply{float:left;padding:5px}.setting-name{font-weight:700;display:block}.device-detail{float:left}.device-title{display:block;white-space:nowrap;float:left;clear:both;font-size:1.2em;color:#306fa9}#detected-device,#installed-device{font-weight:700;font-size:18px;padding:.5em}.modal{display:none;position:fixed;z-index:1;padding-top:100px;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4)}.modal-content{background-color:#fefefe;margin:auto;padding:20px;border:1px solid #888;width:80%}</style><body onload=init(!0)><div class="navbar corner-top corner-bottom"><span class=bar-title><%= setup_device_list %></span><button onclick=backup()><%= setup_backup %></button> <button onclick=restore()><%= setup_restore %></button> <button onclick=erase()><%= setup_erase_eeprom %></button> <button onclick=list()><%= setup_refresh %></button></div><div id=device-list><div id=installed-device> <%= setup_installed_device %> </div><div id=installed-list></div><div id=detected-device> <%= setup_detected_device %> </div><div id=detected-list></div></div><div class="device-container extsensor-device"><table><tr><td rowspan=2><div class=device-title></div><br><button><%= setup_apply %></button></td><td><div class=device-setting-container><span class=setting-name><%= setup_device_slot %></span><select class=slot-select><option value=-1><%= setup_unassigned %></option><option value=0>0</option><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option><option value=15>15</option></select></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_hardware_type %></span><span class="setting-value device-type"><%= setup_external_sensor %></span></div></td><td><div class="device-setting-container device-address-container"><span class=setting-name></span> <span class="setting-value device-address"></span></div></td></tr><tr><td><div class=device-setting-container><span class=setting-name><%= setup_controller_pin %></span><span class="setting-value device-pin"></span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_value %></span><span class="setting-value device-value">--</span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_function %></span><select class="setting-value device-function"><option value=0><%= setup_none %></option><option value=5><%= setup_chamber_temp %></option><option value=6><%= setup_room_temp %></option><option value=9><%= setup_beer_temp %></option></select></div></td></tr></table></div><div class="device-container sensor-device"><table><tr><td rowspan=2><div class=device-title></div><br><button><%= setup_apply %></button></td><td><div class=device-setting-container><span class=setting-name><%= setup_device_slot %></span><select class=slot-select><option value=-1><%= setup_unassigned %></option><option value=0>0</option><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option><option value=15>15</option></select></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_hardware_type %></span><span class="setting-value device-type"><%= setup_sensor %></span></div></td><td><div class="device-setting-container device-address-container"><span class=setting-name><%= setup_address %></span><span class="setting-value device-address"></span></div></td></tr><tr><td><div class=device-setting-container><span class=setting-name><%= setup_controller_pin %></span><span class="setting-value device-pin"></span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_value %></span><span class="setting-value device-value"></span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_function %></span><select class="setting-value device-function"><option value=0><%= setup_none %></option><option value=5><%= setup_chamber_temp %></option><option value=6><%= setup_room_temp %></option><option value=9><%= setup_beer_temp %></option></select></div></td></tr></table></div><div class="device-container pin-device"><table><tr><td rowspan=2><div class=device-title></div><br><button><%= setup_apply %></button></td><td><div class=device-setting-container><span class=setting-name><%= setup_device_slot %></span><select class=slot-select><option value=-1><%= setup_unassigned %></option><option value=0>0</option><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option><option value=15>15</option></select></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_hardware_type %></span><span class="setting-value device-type"><%= setup_pin %></span></div></td><td><div class="device-setting-container device-pintype-container"><span class=setting-name><%= setup_pin_type %></span><select class="setting-value device-pintype"><option value=0><%= setup_not_inverted %></option><option value=1><%= setup_inverted %></option></select></div></td></tr><tr><td><div class=device-setting-container><span class=setting-name><%= setup_controller_pin %></span><span class="setting-value device-pin"></span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_value %></span><span class="setting-value device-value"></span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_function %></span><select class="setting-value device-function"><option value=0><%= setup_none %></option><option value=1><%= setup_chamber_door %></option><option value=2><%= setup_chamber_heater %></option><option value=3><%= setup_chamber_cooler %></option><option value=4><%= setup_chamber_light %></option><option value=7><%= setup_chamber_fan %></option><option value=14><%= setup_capper %></option><option value=15><%= setup_ptc_cooler %></option></select></div></td></tr></table></div><div class="device-container ow-device"><table><tr><td rowspan=2><div class=device-title></div><br><button><%= setup_apply %></button></td><td><div class=device-setting-container><span class=setting-name><%= setup_device_slot %></span><select class=slot-select><option value=-1><%= setup_unassigned %></option><option value=0>0</option><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option><option value=15>15</option></select></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_hardware_type %></span><span class="setting-value device-type"><%= setup_1wire_actuator %></span></div></td><td><div class="device-setting-container device-address-container"><span class=setting-name><%= setup_address %></span><span class="setting-value device-address"></span></div></td><td><div class="device-setting-container device-channel-container"><span class=setting-name><%= setup_channel %></span><span class="setting-value device-channel"></span></div></td></tr><tr><td><div class=device-setting-container><span class=setting-name><%= setup_controller_pin %>N</span> <span class="setting-value device-pin"></span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_value %></span><span class="setting-value device-value"></span></div></td><td><div class=device-setting-container><span class=setting-name><%= setup_function %></span><select class="setting-value device-function"><option value=0><%= setup_none %></option><option value=1><%= setup_chamber_door %></option><option value=2><%= setup_chamber_heater %></option><option value=3><%= setup_chamber_cooler %></option><option value=4><%= setup_chamber_light %></option><option value=7><%= setup_chamber_fan %></option><option value=14><%= setup_capper %></option><option value=15><%= setup_ptc_cooler %></option></select></div></td><td><div class="device-setting-container device-pintype-container"><span class=setting-name><%= setup_pin_type %></span><select class="setting-value device-pintype"><option value=0><%= setup_not_inverted %></option><option value=1><%= setup_inverted %></option></select></div></td></tr></table></div><div id=blockscreen class=modal><div id=blockscreencontent class=modal-content></div></div></body></html>
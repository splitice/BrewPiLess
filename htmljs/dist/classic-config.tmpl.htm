<!DOCTYPE html><html lang="<%= page_lang %>"><head><meta http-equiv=content-type content="text/html; charset=utf-8"><title> <%= config_page_title %> </title><script>function invoke(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&(200==n.status?e.success(n.responseText):n.onerror(n.status))},n.ontimeout=function(){void 0!==e.timeout?e.timeout():n.onerror(-1)},n.onerror=function(n){void 0!==e.fail&&e.fail(n)},n.open(e.m,e.url,!0),void 0!==e.data?(n.setRequestHeader("Content-Type",void 0!==e.mime?e.mime:"application/x-www-form-urlencoded"),n.send(e.data)):n.send()}var BWF={BrewProfile:"/brewing.json",process:function(msg){if(null==this.raw)for(var key in eval("m={"+msg+"}"),m)void 0!==this.handlers[key]&&this.handlers[key](m[key]);else this.raw(msg)},on:function(n,e){this.handlers[n]=e},send:function(n){1==this.ws.readyState&&this.ws.send(n)},reconnecting:!1,connect:function(){var e=this;if("undefined"!=typeof WebSocket){var n=new WebSocket("ws://"+document.location.host+"/ws");(e.ws=n).onopen=function(){console.log("Connected"),e.onconnect()},n.onclose=function(){e.reconnecting||(console.log("WS close"),e.error(-2),e.auto&&setTimeout(function(){e.reconnect()},5e3))},n.onmessage=function(n){e.process(n.data)}}else alert("Error! WebSocket Not Supported!")},reconnect:function(n){n=void 0!==n;var e=this;e.reconnecting||(n||1!=e.ws.readyState)&&(console.log("reconnect forced:"+n+" state:"+e.ws.readyState),e.reconnecting=!0,e.ws.close(),e.connect(),e.reconnecting=!1)},init:function(n){var e=this;e.error=void 0===n.error?function(){}:n.error,e.handlers=void 0===n.handlers?{}:n.handlers,e.raw=void 0===n.raw?null:n.raw,e.onconnect=void 0===n.onconnect?function(){}:n.onconnect,e.auto=void 0===n.reconnect||n.reconnect,e.connect()},save:function(n,e,o,t){invoke({m:"POST",url:"/fputs",data:"path="+n+"&content="+encodeURIComponent(e),success:function(){o()},fail:function(n){t(n)}})},load:function(n,e,o){invoke({m:"GET",url:n,success:function(n){e(n)},fail:function(n){o(n)}})}}</script><script>function s_ajax(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?t.success(e.responseText):e.onerror(e.status))},e.ontimeout=function(){void 0!==t.timeout?t.timeout():e.onerror(-1)},e.onerror=function(e){void 0!==t.fail&&t.fail(e)},e.open(t.m,t.url,!0),void 0!==t.data?(e.setRequestHeader("Content-Type",void 0!==t.mime?t.mime:"application/x-www-form-urlencoded"),e.send(t.data)):e.send()}var Q=function(e){return document.querySelector(e)}</script><script>function formatIP(t){return"0.0.0.0"==t?"":t}function loadSetting(){s_ajax({url:"config?cfg=1",m:"GET",success:function(t){var e=JSON.parse(t);window.oridata=e,Object.keys(e).map(function(t){var n=Q("input[name="+t+"]");n?n.classList.contains("iptype")?n.value=formatIP(e[t]):"checkbox"==n.type?n.checked=0!=e[t]:n.value=e[t]:(n=Q("select[name="+t+"]"))&&(n.value=e[t])})},fail:function(t){alert("<%= script_config_error_getting_data %>:"+t)}})}function waitrestart(){Q("#waitprompt").style.display="block",Q("#inputform").style.display="none",setTimeout(function(){window.location.reload()},15e3)}function save(){var i=document.querySelectorAll("#sysconfig input"),a={},s=!1;Object.keys(i).map(function(t,n){var e;"submit"!=i[n].type&&(i[n].name&&""!=i[n].name&&(e="checkbox"==i[n].type?i[n].checked?1:0:i[n].value.trim(),a[i[n].name]=e,window.oridata[i[n].name]==e||i[n].classList.contains("nb")||(s=!0)))});var t=Q("select[name=wifi]");a.wifi=t.value,console.log(JSON.stringify(a)),s_ajax({url:"config"+(s?"":"?nb"),data:"data="+encodeURIComponent(JSON.stringify(a)),m:"POST",success:function(t){s&&waitrestart()},fail:function(t){alert("<%= script_config_error_saving_data %>:"+t)}})}function loadMqttSetting(){s_ajax({url:"mqtt",m:"GET",success:function(t){var e=JSON.parse(t);Object.keys(e).map(function(t){var n=Q("input[name="+("mqtt_"+t)+"]");n&&("checkbox"==n.type?n.checked=0!=e[t]:n.value=e[t])})},fail:function(t){alert("<%= script_config_error_getting_data %>:"+t)}})}function saveMqtt(){var i=document.querySelectorAll("#mqtt input"),a={};Object.keys(i).map(function(t,n){var e;"submit"!=i[n].type&&(i[n].name&&""!=i[n].name&&(e="checkbox"==i[n].type?i[n].checked?1:0:i[n].value.trim(),a[i[n].name.split("_")[1]]=e))}),console.log(JSON.stringify(a)),s_ajax({url:"mqtt",data:"data="+encodeURIComponent(JSON.stringify(a)),m:"POST",success:function(t){alert("done")},fail:function(t){alert("<%= script_config_error_saving_data %>:"+t)}})}function load(){Q("#verinfo")&&(Q("#verinfo").innerHTML="v"+JSVERSION,getActiveNavItem()),loadSetting(),loadMqttSetting(),Net.init(),Q("#submitsave").onclick=function(t){return t.preventDefault(),save(),!1},Q("#submitsavemqtt").onclick=function(t){return t.preventDefault(),saveMqtt(),!1}}function validIP(t){var n=t.split("."),e=0;if(4!=n.length)return!1;for(var i=0;i<4;i++){var a=parseInt(n[i]);if(e=(e<<8)+a,255<a)return!1}return e}function modechange(t){}var Net={select:function(t){return document.getElementById("ssid").value=t.innerText||t.textContent,document.getElementById("nwpass").focus(),!1},init:function(){this.litem=Q(".nwlist"),this.litem.parentNode.removeChild(this.litem),this.setupEvent(),this.hide()},nwevent:function(t){void 0!==t.list?this.list(t.list):void 0!==t.ssid&&(""!=t.ssid&&(Q("#connnected-ssid").innerHTML=t.ssid),void 0!==t.ip&&""!=t.ip&&(Q("#sta-ip").innerHTML=t.ip))},rssi:function(t){return 0<t?"?":Math.min(Math.max(2*(t+100),0),100)},list:function(t){var n=Q("#networks");n.innerHTML="";for(var e=0;e<t.length;e++){var i=this.litem.cloneNode(!0);i.getElementsByTagName("a")[0].innerHTML=t[e].ssid;var a=i.getElementsByTagName("span")[0];a.innerHTML=this.rssi(t[e].rssi)+"%",t[e].enc&&(a.className=a.className+" l"),n.appendChild(i)}},setupEvent:function(){var n=this;BWF.init({handlers:{W:function(t){n.nwevent(t)}}})},scan:function(){return Q("#networks").innerHTML="Scanning...",s_ajax({m:"GET",url:"/wifiscan",success:function(){}}),!1},save:function(){var t="nw="+encodeURIComponent(Q("#ssid").value);""!=Q("#nwpass").value&&(t=t+"&pass="+encodeURIComponent(Q("#nwpass").value));var n=validIP(Q("#staticip").value),e=validIP(Q("#gateway").value),i=validIP(Q("#netmask").value);validIP(Q("#dns").value);return n&&e&&i&&(t=t+"&ip="+Q("#staticip").value.trim()+"&gw="+Q("#gateway").value.trim()+"&nm="+Q("#netmask").value.trim()+"&dns="+Q("#dns").value.trim()),s_ajax({m:"POST",url:"/wificon",data:t,success:function(){}}),this.hide(),!1},show:function(){Q("#networkselection").style.display="block"},hide:function(){Q("#networkselection").style.display="none"}}</script><style>#waitprompt{display:none}.modal{display:none;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:fixed;top:0;left:0;right:0;bottom:0;overflow-y:auto;overflow-x:hidden;z-index:1000;-webkit-transition:all .5s cubic-bezier(.23,1,.32,1);transition:all .5s cubic-bezier(.23,1,.32,1);-webkit-transition-delay:0s;transition-delay:0s;background:rgba(0,0,0,.3)}.modal-content{position:relative;padding:2.4rem;background:#fff;background-clip:padding-box;-webkit-box-shadow:0 12px 15px 0 rgba(0,0,0,.25);box-shadow:0 12px 15px 0 rgba(0,0,0,.25);-webkit-transition:all .25s cubic-bezier(.23,1,.32,1);transition:all .25s cubic-bezier(.23,1,.32,1);max-width:600px;padding:2rem}.modal-header{font-weight:700;font-size:1.2em}.center{text-align:center}div,input{padding:5px;font-size:1em}.modal input{width:95%}body{text-align:center;font-family:verdana}.modal button{border:0;border-radius:.3rem;background-color:#1fa3ec;color:#fff;line-height:2.4rem;font-size:1.2rem;width:96%;margin:4px}.scannednetwork{float:right;width:64px;text-align:right}.l{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAALVBMVEX///8EBwfBwsLw8PAzNjaCg4NTVVUjJiZDRUUUFxdiZGSho6OSk5Pg4eFydHTCjaf3AAAAZElEQVQ4je2NSw7AIAhEBamKn97/uMXEGBvozkWb9C2Zx4xzWykBhFAeYp9gkLyZE0zIMno9n4g19hmdY39scwqVkOXaxph0ZCXQcqxSpgQpONa59wkRDOL93eAXvimwlbPbwwVAegLS1HGfZAAAAABJRU5ErkJggg==) no-repeat left center;background-size:1em}#networkselection{text-align:left;display:inline-block;min-width:260px}</style></head><body onload=load()><div id=waitprompt> <%= config_wait_restart %> </div><div id=inputform><div id=sysconfig><form action=# action=post><table><tr><td> <%= config_lcd_auto_off %> </td><td><input name=aoff type=text size=5 maxlength=5 class=nb> <%= config_seconds %> </td></tr><tr><td> <%= config_title %> </td><td><input name=title type=text size=12 maxlength=24></td></tr><tr><td> <%= config_host_network_name %> </td><td><input name=name type=text size=12 maxlength=16></td></tr><tr><td> <%= config_http_port %> </td><td><input name=port type=text size=5 maxlength=5></td></tr><tr><td> <%= config_username %> </td><td><input name=user type=text size=12 maxlength=16 class=nb></td></tr><tr><td> <%= config_password %> </td><td><input name=pass type=password size=12 maxlength=16 class=nb></td></tr><tr><td> <%= config_always_password %> </td><td><input type=checkbox name=protect></td></tr><tr><td> <%= config_network_mode %> </td><td><select name=wifi class=nb onchange=modechange(this)><option value=1><%= config_station %></option><option value=2><%= config_ap %></option><option value=3><%= config_stationap %></option></select></td></tr><tr class=staconfig><td> <%= config_network %> </td><td><button id=connnected-ssid onclick="return Net.show(),!1">...</button></td></tr><tr class=staconfig><td> <%= config_ip %> </td><td><span id=sta-ip></span></td></tr><tr><td> <%= config_save_change %> </td><td><input type=submit id=submitsave name=submit></td></tr></table></form></div></div><div id=networkselection class=modal><div class=modal-content><div class=modal-header> <%= config_network_selection %> </div><div id=networks><div class=nwlist><a href=# onclick=Net.select(this) class=ssid>N</a>&nbsp;<span class=scannednetwork></span></div></div><div class=center><a href=# onclick="return Net.scan()"> <%= config_scan %> </a></div><form method=get action=#><input id=ssid name=ssid length=32 placeholder=SSID><br><input id=nwpass name=nwpass length=64 type=password placeholder=password><br><br><input id=staticip name=ip length=1 placeholder="<%= config_fixedip %>" class="nb iptype"><br><input id=gateway name=gw length=1 placeholder="<%= config_gateway %>" class="nb iptype"><br><input id=netmask name=mask length=1 placeholder="<%= config_netmask %>" class="nb iptype"><br><input id=dns name=dns length=1 placeholder="<%= config_dns %>" class="nb iptype"><br><br><button type=button onclick="return Net.save()"><%= config_save_change %></button> <button onclick="return Net.hide(),!1"><%= dlg_cancel %></button></form></div></div></body></html>